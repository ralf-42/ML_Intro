<!-- MathJax Support für mathematische Formeln -->
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      ignoreHtmlClass: 'tex2jax_ignore',
      processHtmlClass: 'tex2jax_process'
    }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>

<!-- Mermaid Diagramm Support -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'default',
    securityLevel: 'loose',
    flowchart: {
      htmlLabels: true,
      curve: 'basis'
    }
  });
</script>

<!-- Callout Transformation Script -->
<script src="{{ '/assets/js/callouts.js' | relative_url }}"></script>

<!-- Externe Links in neuem Tab öffnen -->
<script>
(function() {
  'use strict';

  console.log('[External Links] Script loaded');

  function processExternalLinks() {
    try {
      var links = document.querySelectorAll('a[href^="http"]');
      var processed = 0;

      console.log('[External Links] Found links:', links.length);

      for (var i = 0; i < links.length; i++) {
        var link = links[i];

        // Prüfen ob extern (nutzt .href Property, nicht getAttribute)
        if (link.href && !link.href.includes(window.location.hostname)) {
          link.setAttribute('target', '_blank');
          link.setAttribute('rel', 'noopener noreferrer');
          processed++;
        }
      }

      console.log('[External Links] Processed:', processed);
    } catch (e) {
      console.error('[External Links] Error:', e);
    }
  }

  // Bei DOMContentLoaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', processExternalLinks);
  } else {
    processExternalLinks();
  }

  // Nochmal bei window.load
  window.addEventListener('load', processExternalLinks);

  // Click-Handler als Fallback
  document.addEventListener('click', function(e) {
    var link = e.target.closest('a');
    if (link && link.href && link.href.match(/^https?:\/\//) && !link.href.includes(window.location.hostname)) {
      link.setAttribute('target', '_blank');
      link.setAttribute('rel', 'noopener noreferrer');
      console.log('[External Links] Click handler:', link.href);
    }
  }, true);

})();
</script>
